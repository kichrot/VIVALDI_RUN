# Программа &quot;Vivaldi\_Run&quot;.Руководство пользователя.

Автор: kichrot

2020 г.

Данное Руководство создано в пакете LibreOffice



ВНИМАНИЕ!!!

Программа &quot;Vivaldi\_Run&quot; распространяется безвозмездно, вместе с исходным кодом, по принципу &quot;как есть&quot;. Автор доводит до сведения пользователей, что не встраивал в программу какого-либо направленного деструктивного кода и вообще считает себя хорошим и добрым существом. Тем не менее, автор отказывается нести какую-либо ответственность за потери данных, причинённые повреждения, упущенную выгоду, сексуальные отклонения, нарушения физического и психического здоровья людей и животных, преступления, войны, стихийные бедствия, тепловую смерть Вселенной и любые другие отрицательные эффекты, связанные с использованием или неиспользованием данного программного продукта.

Программа &quot;Vivaldi\_Run&quot; - это 32-разрядное приложение Windows, которое работает в фоновом режиме и не требует вмешательства пользователя, за исключением начальных настроек, описанных далее в этом руководстве. Программа характеризуется низким потреблением ресурсов ПК, ниже уровня большинства расширений для браузера Google Chrome с похожими функциональными возможностями.

СОДЕРЖАНИЕ:

I. Назначение программы &quot;Vivaldi\_Run&quot;.

II. Состав поставки программы &quot;Vivaldi\_Run&quot; и назначение файлов.

III. Описание основного алгоритма работы программы &quot;Vivaldi\_Run&quot;

IV. Установка и подготовка к работе программы &quot;Vivaldi\_Run&quot;.

V. Подготовка браузера &quot;VIVALDI&quot; к работе с программой &quot;Vivaldi\_Run&quot;.

VI. JS-мод создания новых кнопок.

VII. Реализация &quot;нестандартных&quot; кнопок.

Приложение 1.  Коды виртуальных клавиш.

Приложение 2. Лицензия на библиотеку PCRE



I. Назначение программы &quot;Vivaldi\_Run&quot;.

1) Запуск браузера &quot;VIVALDI&quot; с параметрами командной строки, задаваемыми пользователем в файле &quot;VIVALDI\_COMMAND\_LINE.txt&quot;.

2) Обеспечение функциональности кнопок, создаваемых пользователем в соответствующем JS-моде, на панелях браузера &quot;VIVALDI&quot;.

Обеспечивая функциональность кнопок, создаваемых пользователем, программа &quot;Vivaldi\_Run&quot;,  на основании команд подаваемых соответствующим JS-модом, по сути эмитирует действия пользователя, по нажатию зарегистрированных в браузере   &quot;VIVALDI&quot; сочетаний клавиш, для вызова соответствующих функций браузера &quot;VIVALDI&quot;. Методика, порядок создания и использования JS-мода будет описана далее в данном Руководстве, в разделе IV.



II. Состав поставки программы &quot;Vivaldi\_Run&quot; и назначение файлов.

В состав поставки программы входят следующие файлы и каталоги:

1) файл &quot;Vivaldi\_Run.exe&quot; - исполняемый файл программы &quot;Vivaldi\_Run&quot;

2) файл &quot;VIVALDI\_COMMAND\_LINE.txt&quot; - файл содержащий параметры командной строки для запуска браузера &quot;VIVALDI&quot;. По умолчанию файл пустой и заполняется пользователем, в соответствии с его потребностями.

3)файлы &quot;Руководство пользователя.rtf&quot; и &quot;User manual.rtf&quot; - файлы содержащие данное Руководство, соответственно на русском и английском языках.

4) каталог &quot;JS MOD&quot; - каталог с файлом &quot;New\_button.js&quot; содержащим пример мода на JavaScript, создающего необходимые пользователю кнопки на панелях браузера &quot;VIVALDI&quot;.

5) каталог &quot;source&quot; - каталог с файлами исходного кода программы &quot;Vivaldi\_Run&quot; на языке программирования &quot;Purebasic 5.70&quot; ([https://www.purebasic.com/](https://www.purebasic.com/))  с использованием библиотеки   PCRE. Лицензию на библиотеку  PCRE читайте в Приложение 2 данного Руководства.



III. Описание основного алгоритма работы программы &quot;Vivaldi\_Run&quot;

1) программа &quot;Vivaldi\_Run&quot; запускается непосредственно файлом &quot;Vivaldi\_Run.exe&quot; или через соответствующий ярлык этого файла созданный пользователем.

2) после запуска программа &quot;Vivaldi\_Run&quot; проверяет наличие файла &quot;VIVALDI\_COMMAND\_LINE.txt&quot;, содержащего параметры командной строки для браузера &quot;VIVALDI&quot;. Если файл &quot;VIVALDI\_COMMAND\_LINE.txt&quot; отсутствует, то программа &quot;Vivaldi\_Run&quot; создает пустой файл &quot;VIVALDI\_COMMAND\_LINE.txt&quot; автоматически.

3) программа &quot;Vivaldi\_Run&quot; читает содержимое файла &quot;VIVALDI\_COMMAND\_LINE.txt&quot;.

4) программа &quot;Vivaldi\_Run&quot; проверяет наличие файла запуска браузера &quot;VIVALDI&quot;  - &quot;vivaldi.exe&quot;:

a) при отсутствие файла &quot;vivaldi.exe&quot; программа &quot;Vivaldi\_Run&quot; выводит соответствующее сообщение для пользователя и завершает свою работу. Пользователь должен проверить наличии файла &quot;vivaldi.exe&quot; и после устранения возможных нарушений повторно запустить программу  &quot;Vivaldi\_Run&quot;.

b) при наличии файла &quot;vivaldi.exe&quot; программа &quot;Vivaldi\_Run&quot; запускает браузер &quot;VIVALDI&quot; и транслирует ему параметры командной строки полученные ранее из файла &quot;VIVALDI\_COMMAND\_LINE.txt&quot;.

5) программа &quot;Vivaldi\_Run&quot; ожидает появление окна браузера &quot;VIVALDI&quot; а течении 60 секунд:

а) при отсутствии окна браузера &quot;VIVALDI&quot; в течении 60 секунд программа &quot;Vivaldi\_Run&quot; прекращает свою работу.

b) при появлении в течении 60 секунд окна браузера &quot;VIVALDI&quot; программа &quot;Vivaldi\_Run&quot; начинает свое нормальное функционирование в фоновом режиме, ожидая команд от браузера &quot;VIVALDI&quot;.

6) в процессе нормального функционирования раз в 10 секунд программа &quot;Vivaldi\_Run&quot; проверяет наличие окна браузера &quot;VIVALDI&quot;

7) при пропадании окна браузера &quot;VIVALDI&quot; программа &quot;Vivaldi\_Run&quot; переводится в режим ожидания окна браузера &quot;VIVALDI&quot; в течении 60 секунд:

a) при появлении в течении 60 секунд окна браузера &quot;VIVALDI&quot; программа &quot;Vivaldi\_Run&quot; переходит в режим нормального функционирования и ждет команд от браузера &quot;VIVALDI&quot;

b) при отсутствии в течении 60 секунд окна браузера &quot;VIVALDI&quot; программа &quot;Vivaldi\_Run&quot; прекращает свою работу

8) в процессе нормального функционирования, при поступлении команды от браузера &quot;VIVALDI&quot;, программа &quot;Vivaldi\_Run&quot; выполняет эту команду,  эмулируя нажатия  заданных в команде сочетаний клавиш, путем посылки системных сообщений в адрес активного окна браузера &quot;VIVALDI&quot;.

9) после выполнения команды браузера &quot;VIVALDI&quot; программа &quot;Vivaldi\_Run&quot; переходит в режим нормального функционирования и ожидает следующие команды браузера &quot;VIVALDI&quot;.

Программа &quot;Vivaldi\_Run&quot; всегда работает в единственном экземпляре и обслуживает любое количество окон браузера &quot;VIVALDI&quot;.

При попытке запуска второго экземпляра программы &quot;Vivaldi\_Run&quot;, она запускает второй экземпляр браузера &quot;VIVALDI&quot; и прекращает работу своего второго экземпляра.



IV. Установка и подготовка к работе программы &quot;Vivaldi\_Run&quot;.

1)распакуйте архив с программой &quot;Vivaldi\_Run&quot; в отдельный каталог.

2)скопируйте файлы &quot;Vivaldi\_Run.exe&quot; и &quot;VIVALDI\_COMMAND\_LINE.txt&quot; в каталог с файлом &quot;vivaldi.exe&quot;. В стандартной установке браузера &quot;VIVALDI&quot;это каталоги: &quot;C:\Program Files\Vivaldi\Application&quot; или &quot;C:\Program Files (x86)\Vivaldi\Application&quot; , в зависимости от установленной версии браузера &quot;VIVALDI&quot;  и версии операционной системы WINDOWS.

3)заполните, в случае необходимости, файл &quot;VIVALDI\_COMMAND\_LINE.txt&quot; параметрами командной строки для браузера &quot;VIVALDI&quot;.

Количество и состав параметров командной строки для браузера &quot;VIVALDI&quot; пользователь определяет самостоятельно, исходя из своих потребностей и представлений. Пустой файл &quot;VIVALDI\_COMMAND\_LINE.txt&quot; будет означать запуск браузера &quot;VIVALDI&quot; без параметров командной строки.

Перечень параметров командной строки, которые можно использовать для браузера &quot;VIVALDI&quot;, можно найти по адресу:  [https://peter.sh/experiments/chromium-command-line-switches/#reduce-security-for-testing](https://peter.sh/experiments/chromium-command-line-switches/#reduce-security-for-testing) .

В файле &quot;VIVALDI\_COMMAND\_LINE.txt&quot; параметры командной строки для браузера  &quot;VIVALDI&quot; могут располагаться, как в одной строке, так и в разных. Например так:

--user-data-dir=&quot;D:\Profile\Vivaldi&quot;

--disk-cache-dir=NUL

--media-cache-size=NUL

--process-per-site

--enable-native-gpu-memory-buffers

--enable-features=&quot;CheckerImaging&quot;

--enable-checker-imaging

Правильность написания параметров командной строки для браузера  &quot;VIVALDI&quot; пользователь должен контролировать самостоятельно.

При отсутствии файла &quot;VIVALDI\_COMMAND\_LINE.txt&quot;, в одном каталоге с файлом &quot;Vivaldi\_Run.exe&quot;, он будет создан автоматически, при запуске файла &quot;Vivaldi\_Run.exe&quot;.

4)создайте на рабочем столе Windows ярлык для файла &quot;Vivaldi\_Run.exe&quot;.

После выполнения этих действий программа &quot;Vivaldi\_Run&quot; готова к работе.

V. Подготовка браузера &quot;VIVALDI&quot; к работе с программой &quot;Vivaldi\_Run&quot;.

Подготовка браузера &quot;VIVALDI&quot; к работе с программой &quot;Vivaldi\_Run&quot; заключается в подготовке и подключению к браузеру соответствующего мода на языке JavaScript.

Пример мода включён в состав поставки программы &quot;Vivaldi\_Run&quot;, в виде файла &quot;New\_button.js&quot; в каталоге &quot;JS MOD&quot;. Состав мода рассмотрен в разделе VI данного Руководства.

1) откройте в любом текстовом редакторе файл &quot;New\_button.js&quot; из каталога &quot;JS MOD&quot;.

2) измените, в изменяемой части мода, состав и параметры кнопок создаваемых модом.

3) сохраните мод

4) подключите мод к браузеру &quot;VIVALDI&quot; согласно методике указанной по ссылке:

[https://forum.vivaldi.net/topic/10549/modding-vivaldi](https://forum.vivaldi.net/topic/10549/modding-vivaldi)

По мнению и опыту автора для создания и подключения модов более удобно пользоваться  программой &quot;Vivaldi Mod Manager&quot;:  [https://forum.vivaldi.net/topic/30984/windows-vivaldi-mod-manager](https://forum.vivaldi.net/topic/30984/windows-vivaldi-mod-manager)

5) перезагрузите браузер &quot;VIVALDI&quot;. Если вы выполнили все пункты, то появятся новые кнопки, с заданными вами функциями.

6) отрегулируйте визуальный стиль созданных вами кнопок с использованием CSS скриптов. Правила написания и применения в браузере &quot;VIVALDI&quot; СSS скриптов не входят в данное Руководство и изучаются пользователем самостоятельно.



VI. JS-мод создания новых кнопок.

JS-мод, представленный в файле &quot;New\_button.js&quot; написан на языке JavaScript. Правила написания скриптов и синтаксис языка JavaScript пользователь должен изучить самостоятельно.

Пример JS-мода, представленный в файле &quot;New\_button.js&quot;, содержит в своем составе неизменяемую часть (выделено красным цветом шрифта) и изменяемую часть (выделено зеленым цветом шрифта):

/\* Мод для браузера VIVALDI / Mod for the VIVALDI browser

 \* Создание новых кнопок / Create new buttons

 \* автор: kichrot / author: kichrot

 \* 2020 г. / 2020 year

 \* Используется совместно с утилитой &quot;Vivaldi\_RUN&quot; / Used in conjunction with the &quot;Vivaldi\_run&quot; utility.

 \*/

////////////////////////////////////////////////////////////////////  Неизменяемая часть / The unchanging part  ///////////////////////////////////////////////////////////////////////

function CreateNewButton(KEYPRESS\_NewButton, classNewButton, toolbarNewButton, titleNewButton, svgNewButton) {

         function openClick() {

                 var OLD\_title = document.title;

            document.title = &#39;VIVALDI\_EMULATE\_KEYPRESS &#39; + KEYPRESS\_NewButton;

            setTimeout(

                                  () =\&gt; {

                                    document.title = OLD\_title;

                                  }, 50);

    }

    function NewButton () {

        var toolbar = document.querySelector(toolbarNewButton);

        var outer\_div = document.createElement(&#39;div&#39;);

        outer\_div.classList.add(&#39;button-toolbar&#39;, classNewButton);

        outer\_div.title = titleNewButton;

        var button = document.createElement(&#39;button&#39;);

        button.onclick = openClick;

        button.innerHTML = svgNewButton;

        outer\_div.appendChild(button);

        toolbar.appendChild(outer\_div);

    }

    setTimeout(function wait() {

        var toolbar = document.querySelector(toolbarNewButton);

        if (toolbar) {

           NewButton();

        } else {

            setTimeout(wait, 300);

        }

    }, 300);

}

/////////////////////////////////// Завершение неизменяемой части /  The completion of the unchanged parts ////////////////////////////////////////////////////////

/////////////////////////////////// Изменяемая пользователем часть / User-modifiable part /////////////////////////////////////////////////////////////////////////////////

/\* Кнопка удалить данные просмотра  / Button to remove browsing data  \*/

var NewButton\_KEYPRESS = &#39; &quot;17&quot; &quot;16&quot; &quot;46&quot;&#39;;

var NewButtonClass = &#39;mod-clear-histori&#39;;

var NewButtonToolbar = &#39;.toolbar-addressbar.toolbar \&gt; .toolbar.toolbar-droptarget.toolbar-mainbar&#39;;

var NewButtonTitle = &#39;Очистка данных браузера / Clearing browser data&#39;;

var NewButtonSvg = &#39;\&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;chocolate&quot;\&gt;\&lt;path d=&quot;M18.58 0c-1.234 0-2.377.616-3.056 1.649-.897 1.37-.854 3.261-1.368 4.444-.741 1.708-3.873.343-5.532-.524-2.909 5.647-5.025 8.211-6.845 10.448 6.579 4.318 1.823 1.193 12.19 7.983 2.075-3.991 4.334-7.367 6.825-10.46-1.539-1.241-4.019-3.546-2.614-4.945 1-1 2.545-1.578 3.442-2.95 1.589-2.426-.174-5.645-3.042-5.645zm-5.348 21.138l-1.201-.763c0-.656.157-1.298.422-1.874-.609.202-1.074.482-1.618 1.043l-3.355-2.231c.531-.703.934-1.55.859-2.688-.482.824-1.521 1.621-2.331 1.745l-1.302-.815c1.136-1.467 2.241-3.086 3.257-4.728l8.299 5.462c-1.099 1.614-2.197 3.363-3.03 4.849zm6.724-16.584c-.457.7-2.445 1.894-3.184 2.632-.681.68-1.014 1.561-.961 2.548.071 1.354.852 2.781 2.218 4.085-.201.265-.408.543-.618.833l-8.428-5.548.504-.883c1.065.445 2.1.678 3.032.678 1.646 0 2.908-.733 3.464-2.012.459-1.058.751-3.448 1.206-4.145 1.206-1.833 3.964-.017 2.767 1.812zm-.644-.424c-.265.41-.813.523-1.22.257-.409-.267-.522-.814-.255-1.223.267-.409.813-.524 1.222-.257.408.266.521.817.253 1.223z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);

/\* Кнопка переход на Экспресс-панель / The go to button on the speed dial \*/

var NewButton\_KEYPRESS = &#39;&quot;10&quot;&#39;;

var NewButtonClass = &#39;mod-open-startpage&#39;;

var NewButtonToolbar = &#39;.toolbar-addressbar.toolbar \&gt; .toolbar.toolbar-droptarget.toolbar-mainbar&#39;;

var NewButtonTitle = &#39;Перейти на Экспресс-панель&#39;;

var NewButtonSvg = &#39;\&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;mediumvioletred&quot;\&gt;\&lt;path d=&quot;M20 19h-4v-4h4v4zm-6-10h-4v4h4v-4zm6 0h-4v4h4v-4zm-12 6h-4v4h4v-4zm16-14v22h-24v-22h24zm-2 6h-20v14h20v-14zm-8 8h-4v4h4v-4zm-6-6h-4v4h4v-4z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);

/\* Кнопка настроек браузера / Browser settings button  \*/

var NewButton\_KEYPRESS = &#39; &quot;17&quot; &quot;123&quot;&#39;;

var NewButtonClass = &#39;mod-open-settings&#39;;

var NewButtonToolbar = &#39;.toolbar-addressbar.toolbar \&gt; .toolbar.toolbar-droptarget.toolbar-mainbar&#39;;

var NewButtonTitle = &#39;Настройки браузера / Your browser settings&#39;;

var NewButtonSvg = &#39;\&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;darkblue&quot;\&gt;\&lt;path d=&quot;M24 14v-4h-3.23c-.229-1.003-.624-1.94-1.156-2.785l2.286-2.286-2.83-2.829-2.286 2.286c-.845-.532-1.781-.928-2.784-1.156v-3.23h-4v3.23c-1.003.228-1.94.625-2.785 1.157l-2.286-2.286-2.829 2.828 2.287 2.287c-.533.845-.928 1.781-1.157 2.784h-3.23v4h3.23c.229 1.003.624 1.939 1.156 2.784l-2.286 2.287 2.829 2.829 2.286-2.286c.845.531 1.782.928 2.785 1.156v3.23h4v-3.23c1.003-.228 1.939-.624 2.784-1.156l2.286 2.286 2.828-2.829-2.285-2.286c.532-.845.928-1.782 1.156-2.785h3.231zm-12 2c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);

/\* Кнопка полноэкранный режим / Full screen mode button \*/

var NewButton\_KEYPRESS = &#39;&quot;122&quot;&#39;;

var NewButtonClass = &#39;mod-Fullscreen&#39;;

var NewButtonToolbar = &#39;.toolbar-addressbar.toolbar \&gt; .toolbar.toolbar-droptarget.toolbar-mainbar&#39;;

var NewButtonTitle = &#39;Полноэкранный режим / Full screen mode&#39;;

var NewButtonSvg = &#39;\&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;brown&quot;\&gt;\&lt;path d=&quot;M24 9h-2v-5h-7v-2h9v7zm-9 13v-2h7v-5h2v7h-9zm-15-7h2v5h7v2h-9v-7zm9-13v2h-7v5h-2v-7h9zm11 4h-16v12h16v-12z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);

/\* Кнопка поиск на странице / Search button on the page \*/

var NewButton\_KEYPRESS = &#39;&quot;114&quot;&#39;;

var NewButtonClass = &#39;mod-search-on-page&#39;;

var NewButtonToolbar = &#39;.toolbar-addressbar.toolbar \&gt; .toolbar.toolbar-droptarget.toolbar-mainbar&#39;;

var NewButtonTitle = &#39;Поиск на странице / Search on a page&#39;;

var NewButtonSvg = &#39;\&lt;svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;green&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; fill-rule=&quot;evenodd&quot; clip-rule=&quot;evenodd&quot;\&gt;\&lt;path d=&quot;M17.825 24h-15.825v-24h10.189c3.162 0 9.811 7.223 9.811 9.614v10.071l-2-2v-7.228c0-4.107-6-2.457-6-2.457s1.517-6-2.638-6h-7.362v20h11.825l2 2zm-2.026-4.858c-.799.542-1.762.858-2.799.858-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5c0 1-.294 1.932-.801 2.714l4.801 4.872-1.414 1.414-4.787-4.858zm-2.799-7.142c1.656 0 3 1.344 3 3s-1.344 3-3 3-3-1.344-3-3 1.344-3 3-3z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);

/\* Кнопка перезагрузка VIVALDI  / Restart VIVALDI button\*/

var NewButton\_KEYPRESS = &#39;&quot;0&quot;&#39;;

var NewButtonClass = &#39;mod-ReloadVIVALDI&#39;;

var NewButtonToolbar = &#39;.toolbar-addressbar.toolbar \&gt; .toolbar.toolbar-droptarget.toolbar-mainbar&#39;;

var NewButtonTitle = &#39;Перезагрузка VIVALDI /  Restart VIVALDI &#39;;

var NewButtonSvg = &#39;\&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;red&quot;\&gt;\&lt;path d=&quot;M14 12h-4v-12h4v12zm4.213-10.246l-1.213 1.599c2.984 1.732 5 4.955 5 8.647 0 5.514-4.486 10-10 10s-10-4.486-10-10c0-1.915.553-3.694 1.496-5.211l2.166 2.167 1.353-7.014-7.015 1.35 2.042 2.042c-1.287 1.904-2.042 4.193-2.042 6.666 0 6.627 5.373 12 12 12s12-5.373 12-12c0-4.349-2.322-8.143-5.787-10.246z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);

/\* Кнопка  DevTools для интерфейса VIVALDI / DevTools button for the VIVALDI interface \*/

var NewButton\_KEYPRESS = &#39; &quot;07&quot;&#39;;

var NewButtonClass = &#39;mod-DevTools\_VIVALDI&#39;;

var NewButtonToolbar = &#39;.toolbar-addressbar.toolbar \&gt; .toolbar.toolbar-droptarget.toolbar-mainbar&#39;;

var NewButtonTitle = &#39;DevTools для интерфейса VIVALDI / DevTools for the VIVALDI interface&#39;;

var NewButtonSvg = &#39;\&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;indigo&quot;\&gt;\&lt;path d=&quot;M0 0c2.799 1.2 8.683.955 8.307 6.371l-2.143 2.186c-5.338.093-5.239-5.605-6.164-8.557zm10.884 15.402c2.708 2.048 11.824 8.451 11.824 8.451.754.513 1.662-.417 1.136-1.162 0 0-6.607-8.964-8.719-11.619-1.668-2.101-2.502-2.175-5.46-3.046l-1.953 1.997c.936 2.931 1.033 3.76 3.172 5.379zm-4.877 3.332l2.62-2.626c-.26-.244-.489-.485-.69-.724l-2.637 2.643.707.707zm8.244-11.162l4.804-4.814 2.154 2.155-4.696 4.706c.438.525.813 1.021 1.246 1.584l6.241-6.253-4.949-4.95-6.721 6.733c.705.229 1.328.483 1.921.839zm4.837-3.366l-3.972 3.981c.24.199.484.423.732.681l3.946-3.956-.706-.706zm-9.701 12.554l-3.6 3.607-2.979.825.824-2.979 3.677-3.685c-.356-.583-.617-1.203-.859-1.904l-4.626 4.635-1.824 6.741 6.773-1.791 4.227-4.234c-1-.728-1.03-.749-1.613-1.215z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);

/\* Кнопка восстановить закрытую вкладку / Restore closed tab button\*/

var NewButton\_KEYPRESS = &#39; &quot;17&quot; &quot;90&quot;&#39;;

var NewButtonClass = &#39;mod-restore-closed-tab&#39;;

var NewButtonToolbar = &#39;.toolbar.toolbar-tabbar.toolbar-noflex.sync-and-trash-container&#39;;

var NewButtonTitle = &#39;Восстановить закрытую вкладку / Restore a closed tab&#39;;

var NewButtonSvg = &#39;\&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;greenyellow&quot;\&gt;\&lt;path d=&quot;M13.5 2c-5.621 0-10.211 4.443-10.475 10h-3.025l5 6.625 5-6.625h-2.975c.257-3.351 3.06-6 6.475-6 3.584 0 6.5 2.916 6.5 6.5s-2.916 6.5-6.5 6.5c-1.863 0-3.542-.793-4.728-2.053l-2.427 3.216c1.877 1.754 4.389 2.837 7.155 2.837 5.79 0 10.5-4.71 10.5-10.5s-4.71-10.5-10.5-10.5z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);

Неизменяемая часть мода представляет из себя функцию на языке JavaScript, которая создает кнопки с параметрами заданными пользователем в изменяемой части мода.

Изменяемая часть мода состоит из набора значений параметров задаваемых пользователем и вызовом функции создания кнопки с этими параметрами, для каждой создаваемой кнопки.

Состав и назначение параметров создаваемых кнопок:

1. Переменная NewButton\_KEYPRESS — коды виртуальных клавиш, в десятичном формате, которые соответствуют клавишам из комбинация клавиш, для вызова нужной функции браузера &quot;VIVALDI&quot;. Коды виртуальных клавиш, в десятичном формате, можно взять из таблицы в Приложении 1 к данному Руководству, из колонки &quot;Значение (десятичное)&quot;. Каждый код виртуальной клавиши должен заключаться в двойные кавычки, с пробелом между кодами. Вся комбинация кодов должна заключаться в одинарные кавычки.

Пример:

var NewButton\_KEYPRESS =&#39; &quot;17&quot; &quot;16&quot; &quot;46&quot; &#39;

В данном примере, для создаваемой кнопки, задается значение параметра NewButton\_KEYPRESS, соответствующее сочетанию клавиш клавиатуры Ctrl+Shift+DELETE, которое в браузере выводит на экран панель &quot;Удалить данные просмотра&quot;.

2. Переменная   NewButtonClass - имя класса создаваемой кнопки. Имя класса должно быть уникальным, для вашего экземпляра браузера&quot;VIVALDI&quot;.

Пример:

var NewButtonClass = &#39;mod-clear-histori&#39;

В данном примере, для создаваемой кнопки, задается значение параметра  NewButtonClass, задающее уникальное имя класса.

3. Переменная  NewButtonToolbar - идентификаторпанели браузера&quot;VIVALDI&quot; на которую будет помещена создаваемая кнопка. Идентификаторнужной вам панели браузера&quot;VIVALDI&quot; можно узнать при помощи инструмента DevTools, который входит в комплект поставки браузера &quot;VIVALDI&quot;.

Пример:

var NewButtonToolbar =&#39;.toolbar-addressbar.toolbar \&gt; .toolbar.toolbar-droptarget.toolbar-mainbar&#39;

В данном примере, для создаваемой кнопки, задается значение параметра  NewButtonToolbar,  задающее идетификатор панели кнопок навигации, расположенных слева от адресной строки, где и будет располагаться создаваемая кнопка.

4. Переменная NewButtonTitle - подсказка к создаваемой кнопке (tooltip) которая появляется при наведении указателя мыши на кнопку.

Пример:

var NewButtonTitle = &#39;Очистка данных браузера&#39;

В данном примере, для создаваемой кнопки, задается значение параметра  NewButtonTitle, задающего текст подсказки.

5. Переменная NewButtonSvg — SVG код иконки на создаваемой кнопке. Коллекции SVG кодов иконок можно найти в интернете. Одним из лучших сайтов является: [https://iconmonstr.com/](https://iconmonstr.com/)

Пример:

var NewButtonSvg = &#39;\&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;red&quot;\&gt;\&lt;path d=&quot;M14 12h-4v-12h4v12zm4.213-10.246l-1.213 1.599c2.984 1.732 5 4.955 5 8.647 0 5.514-4.486 10-10 10s-10-4.486-10-10c0-1.915.553-3.694 1.496-5.211l2.166 2.167 1.353-7.014-7.015 1.35 2.042 2.042c-1.287 1.904-2.042 4.193-2.042 6.666 0 6.627 5.373 12 12 12s12-5.373 12-12c0-4.349-2.322-8.143-5.787-10.246z&quot;/\&gt;\&lt;/svg\&gt;&#39;;

В данном примере, для создаваемой кнопки, задается значение параметра  NewButtonSvg, задающего SVG-код иконки.

Вызов функции создания новой кнопки:

После задания значений параметров создаваемой кнопки обязательно необходимо произвести вызов функции создания новой кнопки, который имеет в рассматриваемом JS-моде стандартный вид, и не требует редактирования со стороны пользователя:

Пример:

CreateNewButton(NewButton\_KEYPRESS, NewButtonClass, NewButtonToolbar, NewButtonTitle, NewButtonSvg);



VII. Реализация &quot;нестандартных&quot; кнопок

Автор условно делит кнопки реализуемые с использованием программы &quot;Vivaldi\_Run&quot; на &quot;стандартные&quot; и &quot;нестандартные&quot;.

&quot;Стандартные&quot; это кнопки передающие программе &quot;Vivaldi\_Run&quot; команды на эмуляцию сочетаний клавиш зарегистрированных в браузере &quot;VIVALDI&quot;.

&quot;Нестандартные&quot; это кнопки передающие программе &quot;Vivaldi\_Run&quot; команды на эмуляцию сочетаний клавиш и иные действия, регистрация которых в браузере &quot;VIVALDI&quot; невозможна, по различным причинам.

Для каждой &quot;нестандартной&quot; кнопки автор назначил значение параметра NewButton\_KEYPRESS, который не подлежит изменению.

В текущей версии программы &quot;Vivaldi\_Run&quot; реализовано обеспечение функциональности следующих  &quot;нестандартных&quot; кнопок:

1) кнопка  перезагрузки браузера &quot;VIVALDI&quot;.

Назначено  значение NewButton\_KEYPRESS=&#39; &quot;0&quot; &#39;

2) кнопка открытия окна инструмента разработчика &quot;DevTools&quot; для интерфейса браузера &quot;VIVALDI&quot;.

Назначено  значение NewButton\_KEYPRESS=&#39; &quot;07&quot; &#39;

3) кнопка перехода на Экспресс-панель в текущей вкладке

Назначено  значение NewButton\_KEYPRESS=&#39; &quot;10&quot; &#39;

ВНИМАНИЕ!

Для обеспечения функционирования &quot;нестандартных&quot; кнопок нельзя изменять в браузере &quot;VIVALDI&quot; сочетания клавиш для следующих функций:

- Вставить и перейти

- Новая вкладка

- Закрыть вкладку









Приложение 1

# Коды виртуальных клавиш.

В следующей таблице показаны символьные имена констант, десятичные значения и эквиваленты мыши или клавиатуры для кодов виртуальных клавиш, используемых системой. Коды перечислены в числовом порядке.

| Символическое имя константы | Значение (десятичное)  | Эквивалент мыши или клавиатуры |
| --- | --- | --- |
| VK\_LBUTTON | 1 | Left mouse button |
| VK\_RBUTTON | 2 | Right mouse button |
| VK\_CANCEL | 3 | Control-break processing |
| VK\_MBUTTON | 4 | Middle mouse button (three-button mouse) |
| VK\_XBUTTON1 | 5 | Windows 2000: X1 mouse button |
| VK\_XBUTTON2 | 6 | Windows 2000: X2 mouse button |
| — | 7 | Undefined |
| VK\_BACK | 8 | BACKSPACE key |
| VK\_TAB | 9 | TAB key |
| — | 10–11 | Reserved |
| VK\_CLEAR | 12 | CLEAR key |
| VK\_RETURN | 13 | ENTER key |
| — | 14–15 | Undefined |
| VK\_SHIFT | 16 | SHIFT key |
| VK\_CONTROL | 17 | CTRL key |
| VK\_MENU | 18 | ALT key |
| VK\_PAUSE | 19 | PAUSE key |
| VK\_CAPITAL | 20 | CAPS LOCK key |
| VK\_KANA | 21 | IME Kana mode |
| VK\_HANGUEL | 21 | IME Hanguel mode (maintained for compatibility; use VK\_HANGUL) |
| VK\_HANGUL | 21 | IME Hangul mode |
| — | 22 | Undefined |
| VK\_JUNJA | 23 | IME Junja mode |
| VK\_FINAL | 24 | IME final mode |
| VK\_HANJA | 25 | IME Hanja mode |
| VK\_KANJI | 25 | IME Kanji mode |
| — | 26 | Undefined |
| VK\_ESCAPE | 27 | ESC key |
| VK\_CONVERT | 28 | IME convert |
| VK\_NONCONVERT | 29 | IME nonconvert |
| VK\_ACCEPT | 30 | IME accept |
| VK\_MODECHANGE | 31 | IME mode change request |
| VK\_SPACE | 32 | SPACEBAR |
| VK\_PRIOR | 33 | PAGE UP key |
| VK\_NEXT | 34 | PAGE DOWN key |
| VK\_END | 35 | END key |
| VK\_HOME | 36 | HOME key |
| VK\_LEFT | 37 | LEFT ARROW key |
| VK\_UP | 38 | UP ARROW key |
| VK\_RIGHT | 39 | RIGHT ARROW key |
| VK\_DOWN | 40 | DOWN ARROW key |
| VK\_SELECT | 41 | SELECT key |
| VK\_PRINT | 42 | PRINT key |
| VK\_EXECUTE | 43 | EXECUTE key |
| VK\_SNAPSHOT | 44 | PRINT SCREEN key |
| VK\_INSERT | 45 | INS key |
| VK\_DELETE | 46 | DEL key |
| VK\_HELP | 47 | HELP key |
|   | 48 | 0 key |
|   | 49 | 1 key |
|   | 50 | 2 key |
|   | 51 | 3 key |
|   | 52 | 4 key |
|   | 53 | 5 key |
|   | 54 | 6 key |
|   | 55 | 7 key |
|   | 56 | 8 key |
|   | 57 | 9 key |
| — | 58–64 | Undefined |
|   | 65 | A key |
|   | 66 | B key |
|   | 67 | C key |
|   | 68 | D key |
|   | 69 | E key |
|   | 70 | F key |
|   | 71 | G key |
|   | 72 | H key |
|   | 73 | I key |
|   | 74 | J key |
|   | 75 | K key |
|   | 76 | L key |
|   | 77 | M key |
|   | 78 | N key |
|   | 79 | O key |
|   | 80 | P key |
|   | 81 | Q key |
|   | 82 | R key |
|   | 83 | S key |
|   | 84 | T key |
|   | 85 | U key |
|   | 86 | V key |
|   | 87 | W key |
|   | 88 | X key |
|   | 89 | Y key |
|   | 90 | Z key |
| VK\_LWIN | 91 | Left Windows key (Microsoft® Natural® keyboard) |
| VK\_RWIN | 92 | Right Windows key (Natural keyboard) |
| VK\_APPS | 93 | Applications key (Natural keyboard) |
| — | 94 | Reserved |
| VK\_SLEEP | 95 | Computer Sleep key |
| VK\_NUMPAD0 | 96 | Numeric keypad 0 key |
| VK\_NUMPAD1 | 97 | Numeric keypad 1 key |
| VK\_NUMPAD2 | 98 | Numeric keypad 2 key |
| VK\_NUMPAD3 | 99 | Numeric keypad 3 key |
| VK\_NUMPAD4 | 100 | Numeric keypad 4 key |
| VK\_NUMPAD5 | 101 | Numeric keypad 5 key |
| VK\_NUMPAD6 | 102 | Numeric keypad 6 key |
| VK\_NUMPAD7 | 103 | Numeric keypad 7 key |
| VK\_NUMPAD8 | 104 | Numeric keypad 8 key |
| VK\_NUMPAD9 | 105 | Numeric keypad 9 key |
| VK\_MULTIPLY | 106 | Multiply key |
| VK\_ADD | 107 | Add key |
| VK\_SEPARATOR | 108 | Separator key |
| VK\_SUBTRACT | 109 | Subtract key |
| VK\_DECIMAL | 110 | Decimal key |
| VK\_DIVIDE | 111 | Divide key |
| VK\_F1 | 112 | F1 key |
| VK\_F2 | 113 | F2 key |
| VK\_F3 | 114 | F3 key |
| VK\_F4 | 115 | F4 key |
| VK\_F5 | 116 | F5 key |
| VK\_F6 | 117 | F6 key |
| VK\_F7 | 118 | F7 key |
| VK\_F8 | 119 | F8 key |
| VK\_F9 | 120 | F9 key |
| VK\_F10 | 121 | F10 key |
| VK\_F11 | 122 | F11 key |
| VK\_F12 | 123 | F12 key |
| VK\_F13 | 124 | F13 key |
| VK\_F14 | 125 | F14 key |
| VK\_F15 | 126 | F15 key |
| VK\_F16 | 127 | F16 key |
| VK\_F17 | 128H | F17 key |
| VK\_F18 | 129H | F18 key |
| VK\_F19 | 130H | F19 key |
| VK\_F20 | 131H | F20 key |
| VK\_F21 | 132H | F21 key |
| VK\_F22 | 133H | F22 key |
| VK\_F23 | 134H | F23 key |
| VK\_F24 | 135H | F24 key |
| — | 136–143 | Unassigned |
| VK\_NUMLOCK | 144 | NUM LOCK key |
| VK\_SCROLL | 145 | SCROLL LOCK key |
|   | 146–150 | OEM specific |
| — | 151–159 | Unassigned |
| VK\_LSHIFT | 160 | Left SHIFT key |
| VK\_RSHIFT | 161 | Right SHIFT key |
| VK\_LCONTROL | 162 | Left CONTROL key |
| VK\_RCONTROL | 163 | Right CONTROL key |
| VK\_LMENU | 164 | Left MENU key |
| VK\_RMENU | 165 | Right MENU key |
| VK\_BROWSER\_BACK | 166 | Windows 2000: Browser Back key |
| VK\_BROWSER\_FORWARD | 167 | Windows 2000: Browser Forward key |
| VK\_BROWSER\_REFRESH | 168 | Windows 2000: Browser Refresh key |
| VK\_BROWSER\_STOP | 169 | Windows 2000: Browser Stop key |
| VK\_BROWSER\_SEARCH | 170 | Windows 2000: Browser Search key |
| VK\_BROWSER\_FAVORITES | 171 | Windows 2000: Browser Favorites key |
| VK\_BROWSER\_HOME | 172 | Windows 2000: Browser Start and Home key |
| VK\_VOLUME\_MUTE | 173 | Windows 2000: Volume Mute key |
| VK\_VOLUME\_DOWN | 174 | Windows 2000: Volume Down key |
| VK\_VOLUME\_UP | 175 | Windows 2000: Volume Up key |
| VK\_MEDIA\_NEXT\_TRACK | 176 | Windows 2000: Next Track key |
| VK\_MEDIA\_PREV\_TRACK | 177 | Windows 2000: Previous Track key |
| VK\_MEDIA\_STOP | 178 | Windows 2000: Stop Media key |
| VK\_MEDIA\_PLAY\_PAUSE | 179 | Windows 2000: Play/Pause Media key |
| VK\_LAUNCH\_MAIL | 180 | Windows 2000: Start Mail key |
| VK\_LAUNCH\_MEDIA\_SELECT | 181 | Windows 2000: Select Media key |
| VK\_LAUNCH\_APP1 | 182 | Windows 2000: Start Application 1 key |
| VK\_LAUNCH\_APP2 | 183 | Windows 2000: Start Application 2 key |
| — | 184-185 | Reserved |
| VK\_OEM\_1 | 186 | Windows 2000: For the US standard keyboard, the &#39;;:&#39; key |
| VK\_OEM\_PLUS | 187 | Windows 2000: For any country/region, the &#39;+&#39; key |
| VK\_OEM\_COMMA | 188 | Windows 2000: For any country/region, the &#39;,&#39; key |
| VK\_OEM\_MINUS | 189 | Windows 2000: For any country/region, the &#39;-&#39; key |
| VK\_OEM\_PERIOD | 190 | Windows 2000: For any country/region, the &#39;.&#39; key |
| VK\_OEM\_2 | 191 | Windows 2000: For the US standard keyboard, the &#39;/?&#39; key |
| VK\_OEM\_3 | 192 | Windows 2000: For the US standard keyboard, the &#39;`~&#39; key |
| — | 193–215 | Reserved |
| — | 216–218 | Unassigned |
| VK\_OEM\_4 | 219 | Windows 2000: For the US standard keyboard, the &#39;[{&#39; key |
| VK\_OEM\_5 | 220 | Windows 2000: For the US standard keyboard, the &#39;\|&#39; key |
| VK\_OEM\_6 | 221 | Windows 2000: For the US standard keyboard, the &#39;]}&#39; key |
| VK\_OEM\_7 | 222 | Windows 2000: For the US standard keyboard, the &#39;single-quote/double-quote&#39; key |
| VK\_OEM\_8 | 223 |   |
| — | 224 | Reserved |
|   | 225 | OEM specific |
| VK\_OEM\_102 | 226 | Windows 2000: Either the angle bracket key or the backslash key on the RT 102-key keyboard |
|   | 227–228 | OEM specific |
| VK\_PROCESSKEY | 229 | Windows 95/98, Windows NT 4.0, Windows 2000: IME PROCESS key |
|   | 230 | OEM specific |
| VK\_PACKET | 231 | Windows 2000: Used to pass Unicode characters as if they were keystrokes. The VK\_PACKET key is the low word of a 32-bit Virtual Key value used for non-keyboard input methods. For more information, see Remark in KEYBDINPUT, SendInput, WM\_KEYDOWN, and WM\_KEYUP |
| — | 232 | Unassigned |
|   | 233–245 | OEM specific |
| VK\_ATTN | 246 | Attn key |
| VK\_CRSEL | 247 | CrSel key |
| VK\_EXSEL | 248 | ExSel key |
| VK\_EREOF | 249 | Erase EOF key |
| VK\_PLAY | 250 | Play key |
| VK\_ZOOM | 251 | Zoom key |
| VK\_NONAME | 252 | Reserved for future use |
| VK\_PA1 | 253 | PA1 key |
| VK\_OEM\_CLEAR | 254 | Clear key |



























Приложение 2

Лицензия на библиотеку PCRE

PCRE LICENCE

------------

PCRE is a library of functions to support regular expressions whose syntax and semantics are as close as possible to those of the Perl 5 language.

Release 7 of PCRE is distributed under the terms of the &amp;quot;BSD&amp;quot; licence, as specified below. The documentation for PCRE, supplied in the &amp;quot;doc&amp;quot; directory, is distributed under the same terms as the software itself. The basic library functions are written in C and are freestanding. Also included in the distribution is a set of C++ wrapper functions.

THE BASIC LIBRARY FUNCTIONS

---------------------------

Written by:       Philip Hazel

Email local part: ph10

Email domain:     cam.ac.uk

University of Cambridge Computing Service,

Cambridge, England.

Copyright (c) 1997-2007 University of Cambridge

All rights reserved.



THE C++ WRAPPER FUNCTIONS

-------------------------

Contributed by:   Google Inc.

Copyright (c) 2007, Google Inc.

All rights reserved.



THE &amp;quot;BSD&amp;quot; LICENCE

-----------------

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

    \* Redistributions of source code must retain the above copyright notice,

      this list of conditions and the following disclaimer.

    \* Redistributions in binary form must reproduce the above copyright

      notice, this list of conditions and the following disclaimer in the

      documentation and/or other materials provided with the distribution.

    \* Neither the name of the University of Cambridge nor the name of Google

      Inc. nor the names of their contributors may be used to endorse or

      promote products derived from this software without specific prior

      written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &amp;quot;AS IS&amp;quot;

AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE

IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE

ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE

LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR

CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF

SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS

INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN

CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)

ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE

POSSIBILITY OF SUCH DAMAGE.

End